# 上海餐厅热度影响因素分析系统

## 项目简介

这是一个关于上海餐厅热度影响因素分析的研究项目。我们通过收集和分析餐厅数据，探索影响餐厅受欢迎程度的各种因素，比如价格、评分、位置、竞争环境等。

这个项目最初是作为高中研究性课题开始的，后来在AI的帮助下对代码进行了优化和完善。整个分析流程从数据清洗开始，到最终用机器学习模型预测餐厅热度，形成了一个完整的数据分析体系。

## 研究背景

在上海这样的大城市里，餐厅数量众多，竞争激烈。我们想了解：
- 什么样的餐厅更容易受到欢迎？
- 价格、口味、环境等因素哪个更重要？
- 地理位置对餐厅热度有什么影响？
- 能否预测一家餐厅的受欢迎程度？

## 技术路线

整个项目按照以下步骤进行：

1. **数据收集与清洗** - 整理餐厅基础数据，处理缺失值和异常值
2. **地理编码** - 将餐厅地址转换为具体的经纬度坐标
3. **空间分析** - 计算餐厅到地铁站的距离，分析位置便利性
4. **竞争环境分析** - 研究餐厅周围的竞争密度
5. **数据可视化** - 用图表展示各种因素的关系
6. **机器学习建模** - 训练模型预测餐厅热度

## 项目文件说明

### 主要Python文件

- **`0_data_cleaner.py`** - 数据清洗和地理编码
  - 功能：清洗原始数据，用高德地图API把地址转成坐标
  - 特点：支持批量处理，出错时能自动重试，还能保存进度

- **`1_metro_distance.py`** - 地铁距离计算
  - 功能：计算每家餐厅到最近地铁站的距离
  - 特点：用Haversine公式精确计算球面距离，支持大量数据快速处理

- **`2_popularity_analyzer.py`** - 餐厅热度分析
  - 功能：分析餐厅热度与价格、评分、位置等因素的关系
  - 特点：生成各种图表，支持中文显示，输出详细分析报告

- **`3_density_analyzer.py`** - 竞争密度分析
  - 功能：分析餐厅周围的竞争环境
  - 特点：用BallTree算法高效计算空间密度，支持不同半径的竞争分析

- **`4_ml_forrest_predictor.py`** - 随机森林预测
  - 功能：用随机森林算法预测餐厅热度
  - 特点：自动特征工程，网格搜索优化参数，防止过拟合

- **`4_ml_regression_predictor.py`** - 回归分析预测
  - 功能：用线性回归、Ridge、Lasso等算法进行预测
  - 特点：对比不同算法性能，提供详细的模型解释

### 数据文件

- `data/` - 存放各种数据文件
- `models/` - 保存训练好的模型
- `logs/` - 程序运行日志

## 如何使用

### 环境要求

- Python 3.8或更高版本
- 建议8GB以上内存
- 支持Windows、macOS、Linux

### 安装步骤

```bash
# 下载项目
git clone https://github.com/edenwang1020-cell/restaurants-popularity-analysis
cd restaurants-popularity-analysis

# 安装需要的包
pip install -r requirements.txt
```

### 运行顺序

建议按照以下顺序运行，因为后面的程序需要前面程序生成的数据：

```bash
# 1. 先清洗数据，把地址转成坐标
python 0_data_cleaner.py

# 2. 计算到地铁站的距离
python 1_metro_distance.py

# 3. 分析餐厅热度与各因素的关系
python 2_popularity_analyzer.py

# 4. 分析竞争环境
python 3_density_analyzer.py

# 5. 用机器学习预测热度
python 4_ml_forrest_predictor.py
```

### 配置说明

每个程序都可以调整参数，比如：
- 文件路径
- 处理批次大小
- 搜索半径
- 模型参数等

具体可以查看每个文件开头的Config类。

## 数据来源

- **餐厅数据**：主要来自大众点评等平台
- **地铁数据**：上海地铁站点坐标信息
- **地理数据**：高德地图API服务

## 主要发现

通过分析，我们发现了一些有趣的结论：

### 影响餐厅热度的重要因素

1. **口味** - 最重要，占14.43%
2. **环境** - 第二重要，占13.16%
3. **价格** - 占12.36%
4. **总评分** - 占11.65%
5. **地铁距离** - 占10.17%

### 竞争环境

上海餐厅竞争非常激烈：
- 96.1%的餐厅处于极高竞争环境
- 只有0.2%的餐厅竞争相对较小

## 技术特点

### 算法选择

- **空间计算**：用Haversine公式计算距离，BallTree算法提高查询效率
- **机器学习**：随机森林处理非线性关系，回归分析提供可解释性
- **特征工程**：自动处理分类变量，智能处理缺失值

### 性能优化

- **批处理**：大量数据分批处理，避免内存溢出
- **向量化**：用NumPy进行高效计算
- **进度保存**：长时间运行的程序支持断点续传

## 遇到的问题和解决方案

### 数据质量问题

- **问题**：原始数据有很多缺失值和异常值
- **解决**：编写了智能清洗程序，自动处理各种数据问题

### 地理编码效率

- **问题**：高德地图API有调用频率限制
- **解决**：实现了批量处理和进度保存，出错时能自动重试

### 中文显示问题

- **问题**：matplotlib图表中文显示为方块
- **解决**：编写了字体管理程序，自动检测和配置中文字体

### 过拟合问题

- **问题**：机器学习模型在训练集表现很好，测试集表现差
- **解决**：使用正则化、交叉验证等技术，并实现了过拟合检测

## 项目收获

通过这个项目，我们学到了：

1. **数据处理**：如何清洗、转换、验证数据
2. **空间分析**：地理坐标计算、空间索引等概念
3. **机器学习**：特征工程、模型选择、参数优化等技能
4. **可视化**：用图表展示数据洞察
5. **工程实践**：错误处理、日志记录、性能优化等

## 未来改进方向

1. **更多算法**：尝试深度学习、集成学习等
2. **实时数据**：接入实时数据源，动态更新分析结果
3. **用户界面**：开发简单的Web界面，方便非技术人员使用
4. **更多城市**：扩展到其他城市的餐厅数据分析

## 联系方式

- **项目地址**：https://github.com/edenwang1020-cell/restaurants-popularity-analysis
- **邮箱**：edenwang1020@gmail.com

## 致谢

感谢以下开源项目的支持：
- scikit-learn：机器学习算法库
- pandas & numpy：数据处理
- matplotlib & seaborn：数据可视化
- 高德地图：地理编码服务

---

**说明**：本项目仅供学习和研究使用，请遵守相关法律法规。
