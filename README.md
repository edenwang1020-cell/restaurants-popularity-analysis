# 上海餐厅热度影响因素分析系统

## 📋 项目概述

本项目是一个基于人工智能算法的上海餐厅热度影响因素分析系统，旨在通过数据挖掘和机器学习技术，深入分析影响餐厅受欢迎程度的各种因素，为餐饮行业提供数据驱动的决策支持。
这是一个高中研究性课题，部分代码经由AI辅助优化。

### 🎯 研究目的

- **探索餐厅热度影响因素**：分析价格、评分、位置、竞争环境等因素对餐厅热度的影响
- **构建预测模型**：使用机器学习算法预测餐厅的受欢迎程度
- **提供商业洞察**：为餐厅选址、定价策略、竞争分析等提供数据支持
- **优化用户体验**：帮助消费者找到更符合需求的餐厅

### 🔬 研究方法

本项目采用**数据驱动的分析方法**，结合**地理信息系统(GIS)**、**空间分析**和**机器学习**技术：

1. **数据收集与预处理**：收集餐厅基础数据，进行地理编码和清洗
2. **空间分析**：计算餐厅到地铁站的距离，分析地理位置对热度的影响
3. **竞争环境分析**：使用空间索引算法分析餐厅周围的竞争密度
4. **统计建模**：构建多种机器学习模型，分析特征重要性
5. **可视化分析**：生成直观的图表和报告，展示分析结果

## 🏗️ 系统架构

```
数据输入 → 数据清洗 → 地理编码 → 空间分析 → 竞争分析 → 机器学习 → 结果输出
   ↓           ↓         ↓         ↓         ↓         ↓         ↓
原始数据   清洗后数据   坐标数据   距离数据   密度数据   预测模型   分析报告
```

## 📁 项目结构

```
wangyichen/
├── 0_data_cleaner.py          # 数据清洗与地理编码
├── 1_metro_distance.py        # 地铁距离计算
├── 2_popularity_analyzer.py   # 餐厅热度分析
├── 3_density_analyzer.py      # 竞争密度分析
├── 4_ml_forrest_predictor.py # 机器学习预测
├── 4_ml_regression_predictor.py # 回归分析预测
├── data/                      # 数据文件目录
│   ├── shanghai_restaurants.json
│   ├── shanghai_subway_stations.csv
│   └── ...
├── models/                    # 模型文件目录
├── logs/                      # 日志文件目录
└── README.md                  # 项目说明文档
```

## 🔧 核心模块介绍

### 1. 数据清洗与地理编码模块 (`0_data_cleaner.py`)

**功能描述**：
- 清洗原始餐厅数据，处理缺失值和异常值
- 使用高德地图API将餐厅地址转换为经纬度坐标
- 支持批量处理和进度恢复，提高处理效率

**主要特性**：
- 智能数据清洗：自动处理缺失值、异常值、重复数据
- 地理编码：批量地址转坐标，支持进度保存和恢复
- 数据验证：确保坐标数据的准确性和完整性
- 错误处理：完善的异常处理和重试机制

**输出文件**：
- `cleaned_shanghai_restaurants.csv` - 清洗后的餐厅数据
- `shanghai_restaurants_with_coordinates.csv` - 带坐标的餐厅数据

### 2. 地铁距离分析模块 (`1_metro_distance.py`)

**功能描述**：
- 计算每家餐厅到最近地铁站的距离
- 使用Haversine公式进行精确的球面距离计算
- 支持距离筛选和统计分析

**主要特性**：
- 精确距离计算：使用Haversine公式计算球面距离
- 批量处理：支持大量数据的快速处理
- 距离筛选：可配置的距离阈值筛选
- 统计分析：生成距离分布和统计报告

**输出文件**：
- `restaurants_with_metro_distance.csv` - 带地铁距离的餐厅数据
- `课题数据_筛选后.csv` - 按距离筛选后的数据

### 3. 餐厅热度分析模块 (`2_popularity_analyzer.py`)

**功能描述**：
- 分析餐厅热度与各种因素的关系
- 生成多种可视化图表，展示分析结果
- 支持中文字体显示，生成专业报告

**主要特性**：
- 多维度分析：价格、评分、位置、类型等多因素分析
- 可视化图表：散点图、箱线图、热力图等多种图表类型
- 中文字体支持：自动配置中文字体，确保图表正确显示
- 统计报告：生成详细的数据分析报告

**输出文件**：
- 多种可视化图表（PNG格式）
- 统计分析报告（TXT格式）

### 4. 竞争密度分析模块 (`3_density_analyzer.py`)

**功能描述**：
- 计算餐厅周围指定半径内的竞争密度
- 使用BallTree算法进行高效的空间查询
- 分析总竞争环境和同类型竞争环境

**主要特性**：
- 空间索引：使用BallTree算法提高查询效率
- 竞争分析：分析总竞争密度和同类型竞争密度
- 智能算法选择：根据数据量自动选择最优算法
- 性能优化：支持批处理和向量化计算

**输出文件**：
- `restaurants_with_density.csv` - 带竞争密度信息的餐厅数据
- 密度分析报告（TXT格式）

### 5. 机器学习预测模块 (`4_ml_forrest_predictor.py`)

**功能描述**：
- 使用随机森林算法预测餐厅热度
- 包含特征工程、模型优化、SHAP解释等完整流程
- 支持模型保存和结果导出

**主要特性**：
- 特征工程：自动处理分类变量和数值变量
- 模型优化：使用网格搜索优化超参数
- 模型评估：交叉验证、过拟合检测、残差分析
- SHAP解释：可解释的机器学习分析（需安装SHAP模块）

**输出文件**：
- 训练好的模型文件（PKL格式）
- 预测结果和评估报告
- 特征重要性分析

### 6. 回归分析预测模块 (`4_ml_regression_predictor.py`)

**功能描述**：
- 使用多种回归算法（线性回归、Ridge、Lasso）进行预测
- 对比不同算法的性能，选择最优模型
- 提供详细的模型解释和特征分析

**主要特性**：
- 多算法对比：线性回归、Ridge回归、Lasso回归
- 正则化处理：防止过拟合，提高模型泛化能力
- 特征选择：自动选择重要特征，提高模型性能
- 模型解释：详细的系数分析和统计检验

## 🚀 使用方法

### 环境要求

- **Python版本**：3.8+
- **操作系统**：Windows/macOS/Linux
- **内存要求**：建议8GB+

### 安装依赖

```bash
# 克隆项目
git clone <repository-url>
cd <project_dir>
# 安装依赖包
pip install -r requirements.txt
```

### 运行流程

#### 1. 数据清洗与地理编码

```bash
python 0_data_cleaner.py
```

**功能**：清洗原始数据，将地址转换为坐标
**输入**：`data/shanghai_restaurants.json`
**输出**：`data/shanghai_restaurants_with_coordinates.csv`

#### 2. 地铁距离计算

```bash
python 1_metro_distance.py
```

**功能**：计算餐厅到地铁站的距离
**输入**：`data/shanghai_restaurants_with_coordinates.csv`
**输出**：`data/restaurants_with_metro_distance.csv`

#### 3. 热度分析

```bash
python 2_popularity_analyzer.py
```

**功能**：分析餐厅热度与各因素的关系
**输入**：`data/restaurants_with_density.csv`
**输出**：可视化图表和分析报告

#### 4. 竞争密度分析

```bash
python 3_density_analyzer.py
```

**功能**：分析餐厅周围的竞争环境
**输入**：`data/课题数据_筛选后.csv`
**输出**：`data/restaurants_with_density.csv`

#### 5. 机器学习预测

```bash
python 4_ml_forrest_predictor.py
```

**功能**：使用随机森林预测餐厅热度
**输入**：`data/restaurants_with_density.csv`
**输出**：预测模型和结果报告

### 配置说明

每个模块都支持自定义配置，主要配置项包括：

- **文件路径**：输入输出文件路径
- **处理参数**：批处理大小、进度间隔等
- **模型参数**：机器学习算法的超参数
- **API配置**：地理编码API密钥等

## 📊 数据说明

### 数据来源

- **餐厅数据**：大众点评等平台的餐厅信息
- **地铁数据**：上海地铁站点坐标信息
- **地理数据**：高德地图API提供的地理编码服务

### 主要字段

- **基础信息**：餐厅名称、类型、商区、地址
- **评分信息**：口味、环境、服务、总评分
- **位置信息**：经度、纬度、地铁距离
- **竞争信息**：周围餐厅数量、同类型餐厅数量
- **热度指标**：评论数量（对数变换后）

## 🔍 分析结果示例

### 特征重要性排序

1. **口味** (14.43%) - 最重要的影响因素
2. **环境** (13.16%) - 第二重要因素
3. **均价** (12.36%) - 价格因素
4. **总评分** (11.65%) - 综合评分
5. **地铁距离** (10.17%) - 位置便利性

### 竞争环境分布

- **低竞争**：0.2% 的餐厅
- **中等竞争**：1.2% 的餐厅
- **高竞争**：2.6% 的餐厅
- **极高竞争**：96.1% 的餐厅

## 📈 技术特色

### 算法优势

- **空间分析**：使用Haversine公式和BallTree算法
- **机器学习**：随机森林、回归分析等多种算法
- **特征工程**：自动编码、缺失值处理、异常值检测
- **模型优化**：网格搜索、交叉验证、过拟合检测

### 性能优化

- **批处理**：支持大数据集的批量处理
- **向量化计算**：使用NumPy进行高效计算
- **空间索引**：BallTree算法提高空间查询效率
- **内存管理**：智能内存使用，避免内存溢出

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目！

### 开发规范

- 遵循PEP 8代码规范
- 添加详细的文档字符串
- 包含适当的错误处理
- 编写单元测试（如适用）

### 报告问题

- 使用Issue模板描述问题
- 提供详细的错误信息和环境信息
- 附上相关的日志文件

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- **项目地址**：[GitHub Repository]
- **问题反馈**：[Issues]
- **邮箱**：[your-email@example.com]

## 🙏 致谢

感谢以下开源项目和服务的支持：

- **scikit-learn**：机器学习算法库
- **pandas & numpy**：数据处理库
- **matplotlib & seaborn**：数据可视化库
- **高德地图API**：地理编码服务
- **开源社区**：提供各种有用的工具和库

---

**注意**：本项目仅供学术研究和学习使用，请遵守相关法律法规和平台使用条款。
